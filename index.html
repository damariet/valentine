<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>Play this game for my class</title>
<style>
:root { --vh: 1vh; }
html, body {
  margin:0; padding:0; width:100%; height:100%;
  overflow:hidden; touch-action:none; background:black;
}
body { height:calc(var(--vh,1vh)*100); }

/* START & TUTORIAL */
#startScreen, #tutorialOverlay {
  position:absolute; width:100%; height:calc(var(--vh,1vh)*100);
  display:flex; justify-content:center; align-items:center; flex-direction:column;
}
#startScreen {
  background: linear-gradient(45deg,#ffccff,#ccffff,#ffffcc,#ffccff);
  background-size:400% 400%; animation:rainbowShift 8s ease infinite;
  z-index:15;
}
@keyframes rainbowShift { 0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%} }
#startScreen h1 { font-size:5.5vw; text-align:center; margin:0 10px; }

/* UI */
button {
  padding:10px 22px; font-size:4.5vw;
  border:3px solid hotpink; background:black; color:hotpink;
  cursor:pointer; margin:15px;
}
#controls { position:fixed; top:8px; right:8px; z-index:20; display:none; font-size:4vw; }

/* GAME AREA */
#gameArea { width:100vw; height:calc(var(--vh,1vh)*100); background:linear-gradient(to top,#120458,#000); position:relative; overflow:hidden; }
#score { position:absolute; top:14px; width:100%; color:cyan; font-size:4.5vw; z-index:5; display:none; }
.heart, .broken { position:absolute; font-size:7vw; }
.heart { color:#ff00ff; }
.broken { color:cyan; }
#basket { position:absolute; bottom:15px; font-size:7vw; color:cyan; display:none; }

/* VALENTINE SCREEN */
#valentineScreen {
  position:absolute; inset:0;
  background:black; color:hotpink;
  display:none; justify-content:center; align-items:center; flex-direction:column;
  font-size:5vw; z-index:20;
}
</style>
</head>
<body>

<!-- Audio -->
<audio id="musicPlayer" loop>
  <source src="https://raw.githubusercontent.com/damariet/valentine/main/Chris_Brown_-_New_Flame_Feat._Usher_And_Rick_Ross_(mp3.pm).mp3" type="audio/mpeg">
</audio>
<audio id="catchSound">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_6e6f8e3d44.mp3">
</audio>

<!-- Screens -->
<div id="startScreen">
  <h1>üíò Winning Autumn's Heart üíò</h1>
  <button id="startBtn">PRESS START</button>
</div>

<div id="tutorialOverlay">
  <div>Drag left or right anywhere to move the basket.</div>
  <button id="demoBtn">Got it!</button>
</div>

<div id="score">LEVEL 1 ‚Äî LOVE: 0 / 5</div>
<div id="controls">
  <button id="pauseBtn">PAUSE</button>
  <button id="resumeBtn" style="display:none;">RESUME</button>
</div>

<div id="gameArea">
  <div id="basket">‚ñÇ‚ñÇ‚ñÇ</div>
</div>

<div id="valentineScreen"></div>

<script>
// Helper to ensure buttons work after dynamic HTML changes
function onDomReady(cb) {
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", cb);
  } else {
    cb();
  }
}

// =====================
// GAME LOGIC VARIABLES
let score = 0, level = 1;
let basketX = window.innerWidth/2, targetX = basketX;
let moveStartX = null, touchActive = false;
let gameLoop, inactivityTimer, isPaused = false, noReturnTimer = null;

// Cached DOM
const startScreen = document.getElementById("startScreen");
const tutorialOverlay = document.getElementById("tutorialOverlay");
const scoreDisplay = document.getElementById("score");
const controls = document.getElementById("controls");
const basket = document.getElementById("basket");
const valentineScreen = document.getElementById("valentineScreen");
const musicPlayer = document.getElementById("musicPlayer");
const catchSound = document.getElementById("catchSound");

basket.style.display = "none";

// Shutdown helper
function resetGame() {
  musicPlayer.pause(); musicPlayer.currentTime = 0;
  level = 1; score = 0;
  controls.style.display = "none";
  valentineScreen.style.display = "none";
  basket.style.display = "none";
  startScreen.style.display = "flex";
  clearInterval(gameLoop);
  clearTimeout(inactivityTimer);
  if (noReturnTimer) clearInterval(noReturnTimer);
}

// =====================
// BUTTON BINDERS
onDomReady(() => {
  const startBtn = document.getElementById("startBtn");
  const demoBtn  = document.getElementById("demoBtn");

  startBtn.addEventListener("click", () => {
    startScreen.style.display = "none";
    showTutorialOverlay();
  });

  demoBtn.addEventListener("click", startDemo);
});

// =====================
// SHOW TUTORIAL
function showTutorialOverlay() {
  tutorialOverlay.style.display = "flex";
}
function startDemo() {
  tutorialOverlay.style.display = "none";
  let count = 0;
  let di = setInterval(() => {
    dropDemoHeart();
    count++;
    if (count>=2) {
      clearInterval(di);
      setTimeout(beginPlay,500);
    }
  },1000);
}

// =====================
// START PLAY
function beginPlay() {
  scoreDisplay.style.display = "block";
  controls.style.display = "block";
  basket.style.display = "block";
  musicPlayer.volume = 0;
  musicPlayer.play().catch(()=>{});
  resetInactivity();
  updateScore();
  gameLoop = setInterval(createHeart, 600 - level*100);
}

// =====================
// UPDATE SCORE AND COLLISION
function updateScore(){
  const targets = [5,10,15];
  scoreDisplay.innerText = `LEVEL ${level} ‚Äî LOVE: ${score} / ${targets[level-1]}`;
}

// =====================
// HEART GENERATION
function createHeart() {
  if (isPaused) return;
  let heart = document.createElement("div");
  let isBroken = Math.random() < (0.2 + level*0.15);
  heart.innerHTML = isBroken ? "üíî" : "‚ô•";
  heart.className = isBroken ? "broken" : "heart";
  heart.style.left = Math.random()*(window.innerWidth - 40) + "px";
  heart.style.top = "-30px";
  document.getElementById("gameArea").appendChild(heart);

  let speed = 2 + level*1.5;
  let fall = setInterval(() => {
    if (isPaused) return;
    heart.style.top = heart.offsetTop + speed + "px";

    // Simple AABB collision
    let hr = heart.getBoundingClientRect();
    let br = basket.getBoundingClientRect();
    let hitX = (hr.left < br.right && hr.right > br.left);
    let hitY = (hr.bottom >= br.top && hr.top <= br.bottom);

    if (hitX && hitY) {
      if (isBroken) score = Math.max(0, score - 1);
      else {
        catchSound.currentTime = 0;
        catchSound.play();
        score++;
      }
      heart.remove(); clearInterval(fall);
      updateScore();
    }

    if (heart.offsetTop > window.innerHeight) {
      heart.remove(); clearInterval(fall);
    }
  }, 30);
}

// =====================
// PAUSE/RESUME
document.getElementById("pauseBtn").addEventListener("click", ()=>{
  isPaused = true;
  clearInterval(gameLoop);
  musicPlayer.pause();
  document.getElementById("pauseBtn").style.display = "none";
  document.getElementById("resumeBtn").style.display = "inline";
});
document.getElementById("resumeBtn").addEventListener("click", ()=>{
  isPaused = false;
  document.getElementById("resumeBtn").style.display = "none";
  document.getElementById("pauseBtn").style.display = "inline";
  musicPlayer.play();
  gameLoop = setInterval(createHeart, 600 - level*100);
});

// =====================
// INACTIVITY
function resetInactivity(){
  clearTimeout(inactivityTimer);
  inactivityTimer = setTimeout(()=>{
    alert("No movement for 20s ‚Äî restarting!");
    resetGame();
  },20000);
}

// =====================
// Touch Basket Movement
document.addEventListener("touchstart",(e)=>{ touchActive=true; moveStartX=e.touches[0].clientX; });
document.addEventListener("touchmove",(e)=>{ if(touchActive){ targetX = e.touches[0].clientX; resetInactivity(); }} ,{passive:false});
document.addEventListener("touchend",()=> touchActive=false);

// =====================
// VALENTINE LOGIC
function showValentine(){
  valentineScreen.innerHTML=`
    <h1>Autumn‚Ä¶ üíò</h1>
    <h2>Will you be my Valentine?</h2>
    <button id="yesBtn">YES</button>
    <button id="noBtn">NO</button>
    <div id="noCountdown"></div>`;
  valentineScreen.style.display="flex";
  bindValentineButtons();
}

// YES behavior
function bindValentineButtons(){
  document.getElementById("yesBtn").addEventListener("click", ()=>{
    valentineScreen.innerHTML=`
      <h1>YOU WON MY HEART üíò</h1>
      <h2>Happy Valentine‚Äôs Day! üíò</h2>
      <button id="restartBtn">RESTART</button>`;
    document.getElementById("restartBtn").addEventListener("click", resetGame);
  });
  document.getElementById("noBtn").addEventListener("mouseover", moveNoBtn);
  document.getElementById("noBtn").addEventListener("click", startNoCountdown);
}

let noMoves = 0;
function moveNoBtn(){
  if(noMoves>=3) return;
  const btn=document.getElementById("noBtn");
  btn.style.position="absolute";
  btn.style.left=Math.random()*(valentineScreen.offsetWidth - btn.offsetWidth)+"px";
  btn.style.top=Math.random()*(valentineScreen.offsetHeight - btn.offsetHeight)+"px";
  noMoves++;
}

function startNoCountdown(){
  valentineScreen.innerHTML=`
    <h1>Oh you thought you could say NO? üòè</h1>
    <div id="noCountdown">Returning in 5</div>`;
  let count=5;
  noReturnTimer = setInterval(()=>{
    count--;
    document.getElementById("noCountdown").innerText=`Returning in ${count}`;
    if(count<=0){
      clearInterval(noReturnTimer);
      noMoves=0;
      showValentine();
    }
  },1000);
}
</script>

</body>
</html>





