<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>Play ME üíñ</title>
<style>
:root { --vh: 1vh; }
html, body {
  margin:0; padding:0;
  width:100%; height:100%;
  overflow:hidden; touch-action:none;
  background:black;
}
body { height:calc(var(--vh,1vh)*100); }

/* START & TUTORIAL */
#startScreen, #tutorialOverlay {
  position:absolute; width:100%; height:calc(var(--vh,1vh)*100);
  display:flex; justify-content:center; align-items:center; flex-direction:column;
}
#startScreen {
  background: linear-gradient(45deg,#ffccff,#ccffff,#ffffcc,#ffccff);
  background-size:400% 400%; animation:rainbowShift 8s ease infinite;
  z-index:15;
}
@keyframes rainbowShift { 0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%} }
#startScreen h1 { font-size:5.5vw; text-align:center; margin:0 10px; }
#tutorialOverlay { background:rgba(0,0,0,0.75); color:cyan; font-size:4.5vw; text-align:center; padding:15px; z-index:16; display:none; }

/* UI */
button {
  padding:10px 22px; font-size:4.5vw;
  border:3px solid hotpink; background:black; color:hotpink;
  cursor:pointer; margin:15px;
}
#controls {
  position:fixed; top:8px; right:8px; z-index:20; display:none;
  font-size:4vw;
}

/* GAME AREA */
#gameArea { width:100vw; height:calc(var(--vh,1vh)*100); background:linear-gradient(to top,#120458,#000); position:relative; overflow:hidden; }
#score { position:absolute; top:14px; width:100%; color:cyan; font-size:4.5vw; z-index:5; display:none; }
.heart, .broken { position:absolute; font-size:7vw; }
.heart { color:#ff00ff; }
.broken { color:cyan; }
#basket { position:absolute; bottom:15px; font-size:7vw; color:cyan; display:none; }

/* VALENTINE SCREEN */
#valentineScreen {
  position:absolute; inset:0;
  background:black; color:hotpink;
  display:none; justify-content:center; align-items:center; flex-direction:column;
  font-size:5vw; z-index:20;
}

/* LEVEL UP */
#levelUpBanner {
  position:absolute; inset:0; display:none;
  justify-content:center; align-items:center;
  z-index:50; font-size:10vw; font-weight:bold;
  color:hotpink; text-shadow:2px 2px 8px black;
}

/* NO COUNTDOWN */
#noCountdown { color:white; font-size:5vw; text-align:center; margin-top:10px; text-shadow:1px 1px 4px black; }
</style>
</head>
<body>

<!-- AUDIO -->
<audio id="musicPlayer" loop>
  <source src="https://raw.githubusercontent.com/damariet/valentine/main/Chris_Brown_-_New_Flame_Feat._Usher_And_Rick_Ross_(mp3.pm).mp3" type="audio/mpeg">
</audio>
<audio id="catchSound">
  <source src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_6e6f8e3d44.mp3">
</audio>

<!-- LEVEL UP -->
<div id="levelUpBanner">LEVEL UP! üí•</div>

<!-- SCREENS -->
<div id="startScreen">
  <h1>üíò Play Me üíò</h1>
  <button onclick="showTutorial()">PRESS START</button>
</div>

<div id="tutorialOverlay">
  <div>Drag left or right anywhere to move the basket.</div>
  <button onclick="runDemo()">Got it!</button>
</div>

<div id="score">LEVEL 1 ‚Äî LOVE: 0 / 5</div>

<div id="controls">
  <button id="pauseBtn">PAUSE</button>
  <button id="resumeBtn" style="display:none;">RESUME</button>
</div>

<div id="gameArea">
  <div id="basket">‚ñÇ‚ñÇ‚ñÇ</div>
</div>

<div id="valentineScreen">
  <h1>Autumn‚Ä¶ üíò</h1>
  <h2>Will you be my Valentine?</h2>
  <button id="yesBtn">YES</button>
  <button id="noBtn">NO</button>
  <div id="noCountdown"></div>
</div>

<script>
// dynamic viewport fix
function setDvh(){ document.documentElement.style.setProperty('--vh', `${window.innerHeight*0.01}px`); }
window.addEventListener('resize', setDvh);
setDvh();

// GAME VARS
let score=0, level=1;
const basket = document.getElementById("basket");
const scoreDisplay = document.getElementById("score");
const musicPlayer = document.getElementById("musicPlayer");
const catchSound = document.getElementById("catchSound");
const levelUpBanner = document.getElementById("levelUpBanner");

let basketX = window.innerWidth/2, targetX=basketX;
let moveStartX=null, touchActive=false, gameLoop, inactivityTimer, isPaused=false;
let noReturn=null;

// Hide until start
basket.style.left=basketX+"px";
basket.style.display="none";

// Smooth follow
function smoothFollow(){
  basketX+=(targetX-basketX)*0.25;
  basket.style.left=basketX+"px";
  requestAnimationFrame(smoothFollow);
}
smoothFollow();

// Input
function handleDrag(x){
  if(!touchActive) return;
  let delta=x-moveStartX;
  targetX+=delta*0.7;
  moveStartX=x;
  resetInactivity();
}
document.addEventListener("touchstart", e=>{touchActive=true; moveStartX=e.touches[0].clientX;});
document.addEventListener("touchmove", e=>{handleDrag(e.touches[0].clientX);}, {passive:false});
document.addEventListener("touchend", ()=>touchActive=false);
document.addEventListener("mousedown", e=>{touchActive=true; moveStartX=e.clientX;});
document.addEventListener("mousemove", e=>{handleDrag(e.clientX);});
document.addEventListener("mouseup", ()=>touchActive=false);

// Auto pause music
document.addEventListener("visibilitychange", ()=>{
  if(document.hidden && !musicPlayer.paused) musicPlayer.pause();
});

// Pause/Resume
const pauseBtn=document.getElementById("pauseBtn");
const resumeBtn=document.getElementById("resumeBtn");
pauseBtn.addEventListener("click", ()=>{
  if(!isPaused){
    togglePause(); musicPlayer.pause();
    pauseBtn.style.display="none"; resumeBtn.style.display="inline";
  }
});
resumeBtn.addEventListener("click", ()=>{
  if(isPaused){
    togglePause(); musicPlayer.play();
    resumeBtn.style.display="none"; pauseBtn.style.display="inline";
  }
});
function togglePause(){
  isPaused=!isPaused;
  if(isPaused) clearInterval(gameLoop);
  else gameLoop=setInterval(createHeart,600-level*100);
}

// Tutorial/Demo
function showTutorial(){
  document.getElementById("startScreen").style.display="none";
  document.getElementById("tutorialOverlay").style.display="flex";
}
function runDemo(){
  document.getElementById("tutorialOverlay").style.display="none";
  let count=0;
  let id=setInterval(()=>{
    dropDemoHeart();
    count++;
    if(count>=2){ clearInterval(id); setTimeout(startGame,500); }
  },1000);
}
function dropDemoHeart(){
  let heart=document.createElement("div");
  heart.innerHTML="‚ô•"; heart.className="heart";
  heart.style.left=Math.random()*(window.innerWidth-40)+"px";
  heart.style.top="-30px";
  document.getElementById("gameArea").appendChild(heart);
  let speed=4;
  let fall=setInterval(()=>{
    heart.style.top=heart.offsetTop+speed+"px";
    if(heart.offsetTop>window.innerHeight){ heart.remove(); clearInterval(fall); }
  },30);
}

// START GAME
function startGame(){
  musicPlayer.volume=0;
  musicPlayer.play().catch(()=>{});
  scoreDisplay.style.display="block";
  document.getElementById("controls").style.display="block";
  basket.style.display="block";
  updateScore();
  gameLoop=setInterval(createHeart,600-level*100);
  resetInactivity();
}

// Inactivity reset
function resetInactivity(){
  clearTimeout(inactivityTimer);
  inactivityTimer=setTimeout(()=>{
    alert("No movement for 20s ‚Äî restarting!");
    resetGame();
  },20000);
}

// HEART LOGIC
function updateScore(){
  const targets=[5,10,15];
  scoreDisplay.innerText=`LEVEL ${level} ‚Äî LOVE: ${score} / ${targets[level-1]}`;
}

// level up banner
function showLevelUp(){
  levelUpBanner.style.display="flex"; levelUpBanner.style.opacity="1";
  setTimeout(()=>{
    levelUpBanner.style.transition="opacity 0.8s";
    levelUpBanner.style.opacity="0";
    setTimeout(()=>{
      levelUpBanner.style.display="none"; levelUpBanner.style.transition="";
    },800);
  },100);
}

function nextLevel(){
  clearInterval(gameLoop);
  if(level<3){
    level++; score=0;
    showLevelUp();
    setTimeout(()=>{
      updateScore();
      gameLoop=setInterval(createHeart,600-level*100);
      resetInactivity();
    },1400);
  } else {
    // level 3 completed ‚Üí to Valentine
    showValentine();
  }
}

function createHeart(){
  if(isPaused) return;
  let heart=document.createElement("div");
  let isBroken=Math.random()<(0.2+level*0.15);
  heart.innerHTML = isBroken?"üíî":"‚ô•";
  heart.className = isBroken?"broken":"heart";
  heart.style.left=Math.random()*(window.innerWidth-40)+"px";
  heart.style.top="-30px";
  document.getElementById("gameArea").appendChild(heart);

  let speed=2+level*1.5;
  let fall=setInterval(()=>{
    if(isPaused) return;
    heart.style.top=heart.offsetTop+speed+"px";

    let hr=heart.getBoundingClientRect();
    let br=basket.getBoundingClientRect();
    let basketHitWidth=br.width*0.6;
    let basketHitX=br.left+(br.width-basketHitWidth)/2;

    if(hr.left < basketHitX+basketHitWidth &&
       hr.left+hr.width > basketHitX &&
       hr.top < br.top+br.height &&
       hr.top+hr.height > br.top){
      if(isBroken){
        score=Math.max(0,score-1);
      } else {
        catchSound.currentTime=0; catchSound.play(); score++;
      }
      heart.remove(); clearInterval(fall);
      updateScore(); resetInactivity();

      const targets=[5,10,15];
      if(score>=targets[level-1]) nextLevel();
    }
    if(heart.offsetTop>window.innerHeight){ heart.remove(); clearInterval(fall); }
  },30);
}

// Valentine screens
function showValentine(){document.getElementById("valentineScreen").style.display="flex";}

document.getElementById("yesBtn").onclick=(()=>{
  document.getElementById("valentineScreen").innerHTML=`
    <h1>YOU WON MY HEART üíò</h1>
    <h2>Happy Valentine‚Äôs Day! üíò</h2>
    <button onclick="resetGame()">RESTART</button>`;
});

// NO behavior with countdown timer
let noBtnMoves=0, noReturn=null;

function attachNoEvents(){
  const btn=document.getElementById("noBtn");
  if(!btn) return;
  btn.onmouseover=()=>{
    if(noBtnMoves>=3) return;
    btn.style.position="absolute";
    const mx=valentineScreen.offsetWidth-btn.offsetWidth;
    const my=valentineScreen.offsetHeight-btn.offsetHeight;
    btn.style.left=Math.random()*mx+"px";
    btn.style.top=Math.random()*my+"px";
    noBtnMoves++;
    if(noBtnMoves>=3) btn.onclick=startNoCountdown;
  };
}
attachNoEvents();

function startNoCountdown(){
  document.getElementById("valentineScreen").innerHTML=`
    <h1>Oh you thought you could say NO? üòè</h1>
    <h2>Happy Valentine‚Äôs Day! üíò</h2>
    <div id="noCountdown">Returning in 5</div>`;
  noBtnMoves=0;
  let count=5;
  noReturn=setInterval(()=>{
    count--;
    document.getElementById("noCountdown").innerText = `Returning in ${count}`;
    if(count<=0){
      clearInterval(noReturn);
      document.getElementById("valentineScreen").innerHTML=`
        <h1>Autumn‚Ä¶ üíò</h1>
        <h2>Will you be my Valentine?</h2>
        <button id="yesBtn">YES</button>
        <button id="noBtn">NO</button>
        <div id="noCountdown"></div>`;
      document.getElementById("yesBtn").onclick=(()=>{
        document.getElementById("valentineScreen").innerHTML=`
          <h1>YOU WON MY HEART üíò</h1>
          <h2>Happy Valentine‚Äôs Day! üíò</h2>
          <button onclick="resetGame()">RESTART</button>`;
      });
      attachNoEvents();
    }
  },1000);
}

function resetGame(){
  musicPlayer.pause(); musicPlayer.currentTime=0;
  level=1; score=0; noBtnMoves=0;
  document.getElementById("controls").style.display="none";
  document.getElementById("valentineScreen").style.display="none";
  basket.style.display="none";
  document.getElementById("startScreen").style.display="flex";
  clearInterval(gameLoop); clearTimeout(inactivityTimer);
  if(noReturn) clearInterval(noReturn);
}
</script>

</body>
</html>








